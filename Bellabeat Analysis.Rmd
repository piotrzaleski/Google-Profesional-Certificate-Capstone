---
title: "Bellabeat - Data Analysis"
date: "2023-03-06"
output: 
  html_document: 
    toc: true
    toc_depth: 3  
    theme: united
    highlight: tango
---
# Introduction

Bellabeat in recent years expanded throughout the world, opening new offices and launching multiple products. Growing e-commerce market brought new opportunities to reach more customers than ever, so naturally to make most of it, new marketing strategies were developed. Bellabeat has not only invested in traditional advertising media, but also focused on digital marketing. As a high-tech company that manufactures health-focused smart products, Bellabeat gathers huge amounts of data about it's customers that can be used to optimize current marketing and product development strategy.

# 1 Ask Phase

## 1.1 What is the business task?

The goal of this analysis is to identify and provide insights on trends within data that explores smart device users’ daily habits, which will hopefully help with development and execution of marketing strategies.

## 1.2 Who are the Key Stakeholders?

Urška Sršen - Bellabeat cofounder and Chief Creative Officer

Sando Mur - Bellabeat cofounder and key member of Bellabeat executive team

Bellabeat Marketing Analytics team

# 2 Prepare Phase

## 2.1 Source

[FitBit Fitness Tracker Data](https://www.kaggle.com/datasets/arashnic/fitbit) was made available by [Mosbius](https://www.kaggle.com/arashnic) (CC0: Public Domain).

## 2.2 Contents and Privacy

This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.

## 2.3 Data Credibility and Integrity

Data to be used has several limitations, that need to be considered during analysis, such as:

- limited sample size (30 users) can be not reflective of the whole population;

- no information on the demographic can lead to potential bias and/or conclusions not applicable for Bellabeat targeted users; and

- presented data is not recent and covers only 2 months of measurements which can be not reflective of the overarching trends throughout the year.

## 2.4 Storage 

All of the data files this analysis is based on can be found [here] (in real scenario path would be linked).

## 2.2 Selected datasets

For this analysis I will focus on data sets measuring:

- daily activity;

- hourly steps; and

- daily sleep.

Due to the the small sample we won't consider for this analysis Weight (8 Users) and heart rate (7 users).

# 3 Process Phase
In this analysis I will focus on R for shareability and to be able to create data visualization for the stakeholders.

## 3.1 Installing and loading the packages

```{r}
library(tidyverse)
library(here)
library(lubridate)
library(janitor)
library(tidyr)
library(dplyr)
library(ggpubr)
library(ggrepel)
```

## 3.2 Importing dataset

```{r}
daily_activity <- read_csv("dailyActivity_merged.csv")

daily_sleep <- read_csv("sleepDay_merged.csv")

hourly_steps <- read_csv("hourlySteps_merged.csv")
```

## 3.3 Previewing the data
```{r}
head(daily_activity)
str(daily_activity)

head(hourly_steps)
str(hourly_steps)

head(daily_sleep)
str(daily_sleep)
```

## 3.4 Cleaning and Formating

As we got accustomed with the format of the data, it is time to remove any errors and inconsistencies.

### 3.4.1 Number of unique users

Before we continue with our cleaning we want to make sure how many unique users are per data frame. Even though 30 is the minimal sample size we will still keep the sleep dataset for practice only.

```{r}
n_distinct(daily_activity$Id)

n_distinct(hourly_steps$Id)

n_distinct(daily_sleep$Id)
```

### 3.4.2 Identify Duplicates

```{r}
sum(duplicated(daily_activity))
sum(duplicated(daily_sleep))
sum(duplicated(hourly_steps))
```

### 3.4.3 Remove duplicates and N/A

```{r}
daily_activity <- daily_activity %>%
  distinct() %>%
  drop_na()

daily_sleep <- daily_sleep %>%
  distinct() %>%
  drop_na()

hourly_steps <- hourly_steps %>%
  distinct() %>%
  drop_na()
```

Check if duplicates were removed from the sleep data

```{r}
sum(duplicated(daily_sleep))
```

### 3.4.4 Clean and rename columns

For the sake of clarity and later merging of the data frames, we will ensure coherent naming system by using correct syntax and changing everything to lowercase.

```{r}
clean_names(daily_activity)
daily_activity <- rename_with(daily_activity, tolower)
clean_names(daily_sleep)
daily_sleep <- rename_with(daily_sleep, tolower)
clean_names(hourly_steps)
hourly_steps <- rename_with(hourly_steps, tolower)
```

### 3.4.5 Setting consitstent date format

Now we need to set the same date format for for daily_activity and daily_sleep so we can marge them later. 

```{r}
daily_activity <- daily_activity %>% 
  rename(date = activitydate) %>% 
  mutate(date = as_date(date, format = "%m/%d/%Y"))
daily_sleep <- daily_sleep %>% 
  rename(date = sleepday) %>% 
  mutate(date = as_date(date, format = "%m/%d/%Y %I:%M:%S %p"))

```

For coherent naming convention and format, we will also change hourly_steps data frame.

```{r}
hourly_steps<- hourly_steps %>% 
  rename(date_time = activityhour) %>% 
  mutate(date_time = as.POSIXct(date_time,format ="%m/%d/%Y %I:%M:%S %p"))
```

## 3.5 Merging datasets

As daily_sleep and daily activity measurements cover the same time periods, we can merge them to see any correlations using Id and date as primary keys

```{r}
daily_activity_sleep <- merge(daily_activity, daily_sleep, by=c("id", "date"))

glimpse(daily_activity_sleep)
```

# 4 Analysis Phase

We will analyze trends of the users of FitBit and determine if that can help us on BellaBeat's marketing strategy

## 4.1 Type of users per activity level

No data on demographic force us to create our own user groups based on data we have. First distinction will be made by measuring average activity levels based on steps made a day.

For reference we will use categorization provided by CQUniversity Australia which can be found [here](https://www.10000steps.org.au/articles/healthy-lifestyles/counting-steps/). 
It establishes 5 levels of activity:

- Sedentary is less than 5,000 steps per day;

- Low active is 5,000 to 7,499 steps per day;

- Fairly active is 7,500 to 9,999 steps per day;

- Active is more than 10,000 steps per day;

- Highly active is more than 12,500 .

First, we need to calculate daily averages (steps, sleep calories) per user.

```{r}
daily_average <- daily_activity_sleep %>% 
  group_by(id) %>% 
  summarise(avg_steps = mean(totalsteps), avg_sleep = mean(totalminutesasleep), avg_calories = mean(calories))

head(daily_average)
```

Now we can assign activity level to a user based on his average steps per day.

```{r}
user_type <- daily_average %>%
  mutate(user_type = case_when(
   avg_steps < 5000 ~ "sedentary",
   avg_steps >= 5000 & avg_steps < 7500 ~ "lightly_active",
   avg_steps >= 7500 & avg_steps < 10000 ~ "fairly_active",
   avg_steps >= 10000 & avg_steps < 12500 ~ "active",
   avg_steps >= 12500 ~ "highly_active"
  ))
 
head(user_type) 
```

To help visualize data, we will assign percentages to each user type representing their participation in the population, and then we will present them on the pie chart.

```{r}
user_type_percentage <- user_type %>%
  group_by(user_type) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>% 
  group_by(user_type) %>% 
  summarise(total_percent = total / totals) %>% 
  mutate(labels = scales::percent(total_percent))

user_type_percentage$user_type <- factor(user_type_percentage$user_type , levels = c("highly_active", "active", "fairly_active", "lightly_active", "sedentary"))

head(user_type_percentage)
```

```{r}
user_type_percentage %>% 
  ggplot(aes(x="", y=total_percent, fill=user_type))+
  geom_bar(stat="identity", width=1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(),
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold")) +
  scale_fill_manual(values = c("#85e085","pink", "#ffd480", "#ff8080", "#e6e600")) +
   geom_text(aes(label = labels),
position = position_stack(vjust = 0.5))+
  labs(title="User type distribution")
```

We can see pretty equal spread of user types between activity levels. Not surprisingly the most highly represented group is the most moderate one (fairly active users). The result of over 20.8% sedentary users shows there is some room for improvement when it comes to advertising motivational content.


## 4.2 Steps and minutes asleep per weekday

To better understand how user activity and sleep looks throughout the week, we will create new data frame and then put it into chart.

```{r}
Sys.setlocale("LC_TIME","English_United States.1252")
```



```{r}
weekday_steps_sleep <- daily_activity_sleep %>%
  mutate(weekday = weekdays(date))

weekday_steps_sleep$weekday <-ordered(weekday_steps_sleep$weekday, levels=c("Monday", "Tuesday", "Wednesday", "Thursday",
"Friday", "Saturday", "Sunday"))

 weekday_steps_sleep <-weekday_steps_sleep%>%
  group_by(weekday) %>%
  summarize (daily_steps = mean(totalsteps), daily_sleep = mean(totalminutesasleep))

head(weekday_steps_sleep)
```

```{r}
ggarrange(
    ggplot(weekday_steps_sleep) +
      geom_col(aes(weekday, daily_steps), fill = "#006699") +
      geom_hline(yintercept = 10000) +
      labs(title = "Daily steps per weekday", x= "", y = "") +
      theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1)),
    ggplot(weekday_steps_sleep, aes(weekday, daily_sleep)) +
      geom_col(fill = "#85e0e0") +
      geom_hline(yintercept = 420) +
      labs(title = "Minutes asleep per weekday", x= "", y = "") +
      theme(axis.text.x = element_text(angle = 45,vjust = 0.5, hjust = 1))
  )
```

Two general observations can be made based on above graphs:

- Taking [recommendation of 10000 steps](https://www.10000steps.org.au/articles/healthy-lifestyles/counting-steps/) as a optimal amount for an adult, users average daily steps do not reach it once; however

- daily sleep [recommendation of 7 or more hours](https://www.cdc.gov/sleep/about_sleep/how_much_sleep.html) is met by users on 4 out of 7 weekdays.

## 4.3 Hourly steps throughout the day

To delve deeper into the steps topic, we will see how their spread through out the day look like. 

First we will separate date_time column from hourly_steps dataset and then visualize the results.

```{r}
hourly_steps <- hourly_steps %>%
  separate(date_time, into = c("date", "time"), sep = " ") %>% 
  mutate(date = ymd(date))

head(hourly_steps)
```

```{r}
hourly_steps %>% 
  group_by(time) %>% 
  summarize(avg_steps = mean(steptotal)) %>% 
  ggplot() +
  geom_col(aes(x=time, y=avg_steps, fill = avg_steps)) +
  labs(title="Hourly steps through out the day", x="", y="") +
  scale_fill_gradient(low="green", high="red") +
  theme(axis.text.x = element_text(angle = 90))
```

## 4.4 Usage of smart devices

### 4.4.1 Day to day usage of smart devices

To see how attractive it is for users to use smart devices, we will check how many days the devices has been worn and categorize them based on the criteria provided below:

- high use - users who use their device between 21 and 31 days;

- moderate use - users who use their device between 10 and 20 days;

- low use - users who use their device between 1 and 10 days.

```{r}
daily_use <- daily_activity_sleep %>% 
  group_by(id) %>% 
  summarize(days_used = sum(n())) %>% 
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ "low use",
    days_used >= 11 & days_used <= 20 ~ "moderate use", 
    days_used >= 21 & days_used <= 31 ~ "high use"
  ))

head(daily_use)
```

We will now put the results into percatages so that they can be better visualized using pie chart.

```{r}
daily_use_percentage <- daily_use %>% 
  group_by(usage) %>%
  summarize(total = n()) %>% 
  mutate(totals = sum(total)) %>% 
  group_by(usage) %>%
  summarize(total_perctentage = total / totals) %>%
  mutate(labels=scales::percent(total_perctentage))
  
daily_use_percentage$usage <- factor(daily_use_percentage$usage, levels = c("high use", "moderate use", "low use"))

head(daily_use_percentage)
  
```

Now for the chart.

```{r}
daily_use_percentage %>% 
  ggplot(aes(x="", y=total_perctentage, fill=usage)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold")) +
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5))+
  scale_fill_manual(values = c("#006633","#00e673","#80ffbf"),
                    labels = c("High use - 21 to 31 days",
                                 "Moderate use - 11 to 20 days",
                                 "Low use - 1 to 10 days"))+
  labs(title="Daily use of smart device")
```

### 4.4.2 During the day usage

To deepen our analysis, we will check how usage look like during the day. Then we will combine day to day usage results with time during the day usage results to get some insight into the users habits.

First, to be able to filter results by daily use of device, we will merge daily_activity with the daily_use data frame.

```{r}
daily_use_merged <- merge(daily_activity,daily_use, by=c("id"))
head(daily_use_merged)
```

Now again we will create 3 categories:
- All day - device was worn all day;
- More than half day - device was worn more than half of the day;
- Less than half day - device was worn less than half of the day;
to which we will assign user data.

```{r}
minutes_worn <- daily_use_merged %>% 
  mutate(total_minutes_worn = veryactiveminutes+fairlyactiveminutes+lightlyactiveminutes+sedentaryminutes)%>%
  mutate (percent_minutes_worn = (total_minutes_worn/1440)*100) %>%
  mutate (worn = case_when(
    percent_minutes_worn == 100 ~ "All day",
    percent_minutes_worn < 100 & percent_minutes_worn >= 50~ "More than half day", 
    percent_minutes_worn < 50 & percent_minutes_worn > 0 ~ "Less than half day"
  ))

head(minutes_worn)
```

As we have done before, to better visualize our results we will create new data frames. In this case we will create four different data frames to arrange them later on on a same visualization.

First data frame will show the total of users and will calculate percentage of minutes worn the device taking into consideration the three categories created.

The three other data frames are filtered by category of daily users so that we can see also the difference of daily use and time use.

```{r}
minutes_worn_percent<- minutes_worn%>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = scales::percent(total_percent))


minutes_worn_highuse <- minutes_worn%>%
  filter (usage == "high use")%>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = scales::percent(total_percent))

minutes_worn_moduse <- minutes_worn%>%
  filter(usage == "moderate use") %>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = scales::percent(total_percent))

minutes_worn_lowuse <- minutes_worn%>%
  filter (usage == "low use") %>%
  group_by(worn) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(worn) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = scales::percent(total_percent))

minutes_worn_highuse$worn <- factor(minutes_worn_highuse$worn, levels = c("All day", "More than half day", "Less than half day"))
minutes_worn_percent$worn <- factor(minutes_worn_percent$worn, levels = c("All day", "More than half day", "Less than half day"))
minutes_worn_moduse$worn <- factor(minutes_worn_moduse$worn, levels = c("All day", "More than half day", "Less than half day"))
minutes_worn_lowuse$worn <- factor(minutes_worn_lowuse$worn, levels = c("All day", "More than half day", "Less than half day"))

head(minutes_worn_percent)
head(minutes_worn_highuse)
head(minutes_worn_moduse)
head(minutes_worn_lowuse)
```

Now lets visualize all of the above.

```{r}
ggarrange(
  ggplot(minutes_worn_percent, aes(x="",y=total_percent, fill=worn)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5)) +
    scale_fill_manual(values = c("#004d99", "#3399ff", "#cce6ff"))+
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5), size = 3.5)+
  labs(title="Time worn per day", subtitle = "Total Users"),
  ggarrange(
  ggplot(minutes_worn_highuse, aes(x="",y=total_percent, fill=worn)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5), 
        legend.position = "none")+
    scale_fill_manual(values = c("#004d99", "#3399ff", "#cce6ff"))+
  geom_text_repel(aes(label = labels),
            position = position_stack(vjust = 0.5), size = 3)+
  labs(title="", subtitle = "High use - Users"), 
  ggplot(minutes_worn_moduse, aes(x="",y=total_percent, fill=worn)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "none") +
    scale_fill_manual(values = c("#004d99", "#3399ff", "#cce6ff"))+
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5), size = 3)+
  labs(title="", subtitle = "Moderate use - Users"), 
  ggplot(minutes_worn_lowuse, aes(x="",y=total_percent, fill=worn)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold"), 
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "none") +
    scale_fill_manual(values = c("#004d99", "#3399ff", "#cce6ff"))+
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5), size = 3)+
  labs(title="", subtitle = "Low use - Users"), 
  ncol = 3), 
  nrow = 2)
```

Per our chart above, we can see pretty fascinating trend.The more days you use the device, the less likely it is for you to use it all day. We can see that Low use users when they actually decide to activate the device a particular day, are more prone to use it all day. Explanation for such trend and how to address it will be provided in the Conclusions section.

# 5 Insights, Conclusions and Recomendations

As said at the beginning, data sets used for this analysis lack information about the demographic, sample size is pretty small and data is not recent. Considering that there are some interesting insights to be taken from the analysis of those data sets but it is recommended to analyse data gathered directly from Bellabeat users.

## 5.1 Insights an Colclusions

Our analysis shows that:

a) Almost 21% users of FitBit Tracker classify as sedentary user (not meting the requirement of 5000 steps a day), and the average user do not achieve the recommended goal of 10000 steps even once a week. Only 20% of the users classify as active or highly Active. Taking as a baseline that, people who use FitBit Tracker want to change their daily activity habits, a conclusion can be made that it is hard to stay motivated during early stages of the change process and break the barrier of 10000 steps (almost 40% of the user are categorized as fairly active). 

b) Sleep habits of the users are pretty good. On average, 4 out of 7 days a week they reach recommended 7 hours of sleep, and during the other 3 they do not sleep less than 6 hours 40 minutes.

c) Usage of the device show the most interesting trend. The more days during a month user wear a device, the less likely it is that they will wear it all day. Explanation of such trend can be that Low use users try to compensate the days their are not using the FitBit Tracker, maybe because they are not active those days, by wearing it whole day. It again shows motivational issue.

## 5.2 Recomendations

We can see that the biggest issue is the motivation to met step goals regularly and to track progress on a daily basis. Expecting same trends after Bellabeat users activity analysis below steps can be undertaken:

a) Award system can be made to motivate new users to meet the minimal goals of 10000 steps and 7 ours of sleep (i.e. discounts for Bellabeat products);

b) Integration of social platform such as forum or board, for users to motivate each other and show their progress;

c) Adding notifications with links to motivational content and studies showing benefits of living active life and sleeping well.

All of the above can be advertised with an emphasis on the motivational aspect but not leaving out the scientific under layer. As we live in a digital era, where platforms like Youtube, Twitter and TiTok are the biggest source of information, a combination of motivational influencers and science propagators can be used to achieve that goal.
